<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Channel Access Caproto Server &mdash; Icarus Pressure Jump for NMR 0.1.0.post59+g7f17555 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PyEpics extension" href="pyepics.html" />
    <link rel="prev" title="Data Analysis" href="data-analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Icarus Pressure Jump for NMR
          </a>
              <div class="version">
                0.1.0.post59+g7f17555
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Introduction and Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">Graphical User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="driver.html">Driver Level</a></li>
<li class="toctree-l1"><a class="reference internal" href="mock-driver.html">Mock Driver Level</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-controller.html">Device Controller Level</a></li>
<li class="toctree-l1"><a class="reference internal" href="digital-controller.html">Digital Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="event-controller.html">Event Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-analysis.html">Data Analysis</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Channel Access Caproto Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-structure">Code structure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyepics.html">PyEpics extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="min_versions.html">Minimum Version of Python and NumPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Icarus Pressure Jump for NMR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Channel Access Caproto Server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/server-caproto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="channel-access-caproto-server">
<h1>Channel Access Caproto Server<a class="headerlink" href="#channel-access-caproto-server" title="Permalink to this headline">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/channel_acces_server_1.png"><img alt="channel access server diagram" src="_images/channel_acces_server_1.png" style="width: 600px;" /></a>
<p>The goal of channel access (CA) is to provide remote access to records and fields(PV database) managed by a server(IOC), including search and discovery of hosts and minimal flow control.</p>
<p>The figure “ca enabled python process” shows an inner diagram of a single Channel Access enabled process which consists of three major modules: server, device, and client. A server is responsible for keeping(hosting) a database(record) of all process variables(PVs) and responsible for updating all subscribed clients if there are any changes in the database. A client provides a pathway to interact with other servers on the network. The client provides write and read functionality that allows writing into(or reading from) a remote PV, and can subscribe to PV updates. If a client is subscribed to PV updates, it will trigger immediate execution of a callback function when an update arrives.</p>
<p>The heart of the CA enabled process is in the device module, which contains all necessary functionality: data processing thread, data acquisition thread with a circular buffer, etc. If there is a new update to the database on the server side, a function in the device module can be directly called, if such action is permitted, or new updates to the database can be put into the pull queue and the device examines it when an opportunity arises. The device module can submit new values to the push queue (io_push_queue) which promptly updates the database(record) on the server side and prompt updates of subscribed clients will follow.</p>
</section>
<section id="code-structure">
<h2>Code structure<a class="headerlink" href="#code-structure" title="Permalink to this headline">¶</a></h2>
<p>The ‘class Server(PVGroup)’, a caproto class, starts with definition of various process variable the server is hosting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dio</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Then the class supports a series of different decorators and corresponding functions that are launched at a different times.</p>
<p>The first one is a startup decorator. This function will be executed upon initialization at the startup of the python process. See example below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@dio</span><span class="o">.</span><span class="n">startup</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">dio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  function body goes here</span>
<span class="sd">  &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The next two decorator are putter and getter. These function are executed when the value of the process variable is updated(putter) or read(getter) from the ca server database.  Note, that putter has an extra variable as an input, which is ‘value’. You can examine the new PV value and act accordingly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@dio</span><span class="o">.</span><span class="n">putter</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">dio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

<span class="nd">@dio</span><span class="o">.</span><span class="n">getter</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">dio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
</pre></div>
</div>
<p>upon the startup of the very first PV, the initialization of the asynchronous thread safe queue is done.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data-analysis.html" class="btn btn-neutral float-left" title="Data Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pyepics.html" class="btn btn-neutral float-right" title="PyEpics extension" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Valentyn Stadnytskyi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>